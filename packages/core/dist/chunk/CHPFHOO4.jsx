import{a as m}from"./H2DQBBBH.jsx";import{access as U,contains as f,focusWithoutScrolling as r,getActiveElement as d,getAllTabbableIn as H,getDocument as j,isFocusable as x,removeItemFromArray as I,visuallyHiddenStyles as w}from"@kobalte/utils";import{createEffect as E,createSignal as D,onCleanup as b}from"solid-js";import{isServer as F}from"solid-js/web";var A="focusScope.autoFocusOnMount",p="focusScope.autoFocusOnUnmount",y={bubbles:!1,cancelable:!0},_={stack:[],active(){return this.stack[0]},add(s){s!==this.active()&&this.active()?.pause(),this.stack=I(this.stack,s),this.stack.unshift(s)},remove(s){this.stack=I(this.stack,s),this.active()?.resume()}};function Y(s,u){let[T,S]=D(!1),h={pause(){S(!0)},resume(){S(!1)}},v=null,g=e=>s.onMountAutoFocus?.(e),L=e=>s.onUnmountAutoFocus?.(e),a=()=>j(u()),O=()=>{let e=a().createElement("span");return e.setAttribute("data-focus-trap",""),e.tabIndex=0,Object.assign(e.style,w),e},M=()=>{let e=u();return e?H(e,!0).filter(t=>!t.hasAttribute("data-focus-trap")):[]},P=()=>{let e=M();return e.length>0?e[0]:null},C=()=>{let e=M();return e.length>0?e[e.length-1]:null},N=()=>{let e=u();if(!e)return!1;let t=d(e);return!t||f(e,t)?!1:x(t)};E(()=>{if(F)return;let e=u();if(!e)return;_.add(h);let t=d(e);if(!f(e,t)){let n=new CustomEvent(A,y);e.addEventListener(A,g),e.dispatchEvent(n),n.defaultPrevented||setTimeout(()=>{r(P()),d(e)===t&&r(e)},0)}b(()=>{e.removeEventListener(A,g),setTimeout(()=>{let n=new CustomEvent(p,y);N()&&n.preventDefault(),e.addEventListener(p,L),e.dispatchEvent(n),n.defaultPrevented||r(t??a().body),e.removeEventListener(p,L),_.remove(h)},0)})}),E(()=>{if(F)return;let e=u();if(!e||!U(s.trapFocus)||T())return;let t=n=>{let c=n.target;c?.closest(`[${m}]`)||(f(e,c)?v=c:r(v))},o=n=>{let i=n.relatedTarget??d(e);i?.closest(`[${m}]`)||f(e,i)||r(v)};a().addEventListener("focusin",t),a().addEventListener("focusout",o),b(()=>{a().removeEventListener("focusin",t),a().removeEventListener("focusout",o)})}),E(()=>{if(F)return;let e=u();if(!e||!U(s.trapFocus)||T())return;let t=O();e.insertAdjacentElement("afterbegin",t);let o=O();e.insertAdjacentElement("beforeend",o);function n(i){let l=P(),k=C();i.relatedTarget===l?r(k):r(l)}t.addEventListener("focusin",n),o.addEventListener("focusin",n);let c=new MutationObserver(i=>{for(let l of i)l.previousSibling===o&&(o.remove(),e.insertAdjacentElement("beforeend",o)),l.nextSibling===t&&(t.remove(),e.insertAdjacentElement("afterbegin",t))});c.observe(e,{childList:!0,subtree:!1}),b(()=>{t.removeEventListener("focusin",n),o.removeEventListener("focusin",n),t.remove(),o.remove(),c.disconnect()})})}export{Y as a};
