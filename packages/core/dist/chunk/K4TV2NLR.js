import { a } from './MCURXMJV.js';
import { g } from './UAI26547.js';
import { a as a$1 } from './BRRMFPGI.js';
import { mergeDefaultProps, access, createEventListener, scrollIntoView, focusWithoutScrolling, callHandler, getFocusableTreeWalker, isAppleDevice, isMac } from '@kobalte/utils';
import { createSignal, createMemo, createEffect, mergeProps, onMount, on, createComputed } from 'solid-js';

var m=class s extends Set{anchorKey;currentKey;constructor(e,t,n){super(e),e instanceof s?(this.anchorKey=t||e.anchorKey,this.currentKey=n||e.currentKey):(this.anchorKey=t,this.currentKey=n);}};function J(s){let[e,t]=a$1(s);return [()=>e()??new m,t]}function L(s){return isAppleDevice()?s.altKey:s.ctrlKey}function w(s){return isMac()?s.metaKey:s.ctrlKey}function H(s){return new m(s)}function X(s,e){if(s.size!==e.size)return !1;for(let t of s)if(!e.has(t))return !1;return !0}function q(s){let e=mergeDefaultProps({selectionMode:"none",selectionBehavior:"toggle"},s),[t,n]=createSignal(!1),[o,a]=createSignal(),g=createMemo(()=>{let p=access(e.selectedKeys);return p!=null?H(p):p}),S=createMemo(()=>{let p=access(e.defaultSelectedKeys);return p!=null?H(p):new m}),[h,M]=J({value:g,defaultValue:S,onChange:p=>e.onSelectionChange?.(p)}),[b,v]=createSignal(access(e.selectionBehavior)),C=()=>access(e.selectionMode),k=()=>access(e.disallowEmptySelection)??!1,T=p=>{(access(e.allowDuplicateSelectionEvents)||!X(p,h()))&&M(p);};return createEffect(()=>{let p=h();access(e.selectionBehavior)==="replace"&&b()==="toggle"&&typeof p=="object"&&p.size===0&&v("replace");}),createEffect(()=>{v(access(e.selectionBehavior)??"toggle");}),{selectionMode:C,disallowEmptySelection:k,selectionBehavior:b,setSelectionBehavior:v,isFocused:t,setFocused:n,focusedKey:o,setFocusedKey:a,selectedKeys:h,setSelectedKeys:T}}function $(s){let[e,t]=createSignal(""),[n,o]=createSignal(-1);return {typeSelectHandlers:{onKeyDown:g=>{if(access(s.isDisabled))return;let S=access(s.keyboardDelegate),h=access(s.selectionManager);if(!S.getKeyForSearch)return;let M=te(g.key);if(!M||g.ctrlKey||g.metaKey)return;M===" "&&e().trim().length>0&&(g.preventDefault(),g.stopPropagation());let b=t(C=>C+M),v=S.getKeyForSearch(b,h.focusedKey())??S.getKeyForSearch(b);v==null&&ne(b)&&(b=b[0],v=S.getKeyForSearch(b,h.focusedKey())??S.getKeyForSearch(b)),v!=null&&(h.setFocusedKey(v),s.onTypeSelect?.(v)),clearTimeout(n()),o(window.setTimeout(()=>t(""),500));}}}}function te(s){return s.length===1||!/^[A-Z]/i.test(s)?s:""}function ne(s){return s.split("").every(e=>e===s[0])}function He(s,e,t){let o=mergeProps({selectOnFocus:()=>access(s.selectionManager).selectionBehavior()==="replace"},s),a=()=>t?.()??e(),{direction:g$1}=g(),S={top:0,left:0};createEventListener(()=>access(o.isVirtualized)?void 0:a(),"scroll",()=>{let i=a();i&&(S={top:i.scrollTop,left:i.scrollLeft});});let{typeSelectHandlers:h}=$({isDisabled:()=>access(o.disallowTypeAhead),keyboardDelegate:()=>access(o.keyboardDelegate),selectionManager:()=>access(o.selectionManager)}),M=()=>access(o.orientation)??"vertical",b=i=>{callHandler(i,h.onKeyDown),i.altKey&&i.key==="Tab"&&i.preventDefault();let u=e();if(!u?.contains(i.target))return;let l=access(o.selectionManager),y=access(o.selectOnFocus),f=c=>{c!=null&&(l.setFocusedKey(c),i.shiftKey&&l.selectionMode()==="multiple"?l.extendSelection(c):y&&!L(i)&&l.replaceSelection(c));},r=access(o.keyboardDelegate),E=access(o.shouldFocusWrap),K=l.focusedKey();switch(i.key){case(M()==="vertical"?"ArrowDown":"ArrowRight"):{if(r.getKeyBelow){i.preventDefault();let c;K!=null?c=r.getKeyBelow(K):c=r.getFirstKey?.(),c==null&&E&&(c=r.getFirstKey?.(K)),f(c);}break}case(M()==="vertical"?"ArrowUp":"ArrowLeft"):{if(r.getKeyAbove){i.preventDefault();let c;K!=null?c=r.getKeyAbove(K):c=r.getLastKey?.(),c==null&&E&&(c=r.getLastKey?.(K)),f(c);}break}case(M()==="vertical"?"ArrowLeft":"ArrowUp"):{if(r.getKeyLeftOf){i.preventDefault();let c=g$1()==="rtl",A;K!=null?A=r.getKeyLeftOf(K):A=c?r.getFirstKey?.():r.getLastKey?.(),f(A);}break}case(M()==="vertical"?"ArrowRight":"ArrowDown"):{if(r.getKeyRightOf){i.preventDefault();let c=g$1()==="rtl",A;K!=null?A=r.getKeyRightOf(K):A=c?r.getLastKey?.():r.getFirstKey?.(),f(A);}break}case"Home":if(r.getFirstKey){i.preventDefault();let c=r.getFirstKey(K,w(i));c!=null&&(l.setFocusedKey(c),w(i)&&i.shiftKey&&l.selectionMode()==="multiple"?l.extendSelection(c):y&&l.replaceSelection(c));}break;case"End":if(r.getLastKey){i.preventDefault();let c=r.getLastKey(K,w(i));c!=null&&(l.setFocusedKey(c),w(i)&&i.shiftKey&&l.selectionMode()==="multiple"?l.extendSelection(c):y&&l.replaceSelection(c));}break;case"PageDown":if(r.getKeyPageBelow&&K!=null){i.preventDefault();let c=r.getKeyPageBelow(K);f(c);}break;case"PageUp":if(r.getKeyPageAbove&&K!=null){i.preventDefault();let c=r.getKeyPageAbove(K);f(c);}break;case"a":w(i)&&l.selectionMode()==="multiple"&&access(o.disallowSelectAll)!==!0&&(i.preventDefault(),l.selectAll());break;case"Escape":i.defaultPrevented||(i.preventDefault(),access(o.disallowEmptySelection)||l.clearSelection());break;case"Tab":if(!access(o.allowsTabNavigation)){if(i.shiftKey)u.focus();else {let c=getFocusableTreeWalker(u,{tabbable:!0}),A,I;do I=c.lastChild(),I&&(A=I);while(I);A&&!A.contains(document.activeElement)&&focusWithoutScrolling(A);}break}}},v=i=>{let u=access(o.selectionManager),l=access(o.keyboardDelegate),y=access(o.selectOnFocus);if(u.isFocused()){i.currentTarget.contains(i.target)||u.setFocused(!1);return}if(i.currentTarget.contains(i.target)){if(u.setFocused(!0),u.focusedKey()==null){let f=E=>{E!=null&&(u.setFocusedKey(E),y&&u.replaceSelection(E));},r=i.relatedTarget;r&&i.currentTarget.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_FOLLOWING?f(u.lastSelectedKey()??l.getLastKey?.()):f(u.firstSelectedKey()??l.getFirstKey?.());}else if(!access(o.isVirtualized)){let f=a();if(f){f.scrollTop=S.top,f.scrollLeft=S.left;let r=f.querySelector(`[data-key="${u.focusedKey()}"]`);r&&(focusWithoutScrolling(r),scrollIntoView(f,r));}}}},C=i=>{let u=access(o.selectionManager);i.currentTarget.contains(i.relatedTarget)||u.setFocused(!1);},k=i=>{a()===i.target&&i.preventDefault();},T=()=>{let i=access(o.autoFocus);if(!i)return;let u=access(o.selectionManager),l=access(o.keyboardDelegate),y;i==="first"&&(y=l.getFirstKey?.()),i==="last"&&(y=l.getLastKey?.());let f=u.selectedKeys();f.size&&(y=f.values().next().value),u.setFocused(!0),u.setFocusedKey(y);let r=e();r&&y==null&&!access(o.shouldUseVirtualFocus)&&focusWithoutScrolling(r);};return onMount(()=>{o.deferAutoFocus?setTimeout(T,0):T();}),createEffect(on([a,()=>access(o.isVirtualized),()=>access(o.selectionManager).focusedKey()],i=>{let[u,l,y]=i;if(l)y&&o.scrollToKey?.(y);else if(y&&u){let f=u.querySelector(`[data-key="${y}"]`);f&&scrollIntoView(u,f);}})),{tabIndex:createMemo(()=>{if(!access(o.shouldUseVirtualFocus))return access(o.selectionManager).focusedKey()==null?0:-1}),onKeyDown:b,onMouseDown:k,onFocusIn:v,onFocusOut:C}}function Ve(s,e){let t=()=>access(s.selectionManager),n=()=>access(s.key),o=()=>access(s.shouldUseVirtualFocus),a=l=>{t().selectionMode()!=="none"&&(t().selectionMode()==="single"?t().isSelected(n())&&!t().disallowEmptySelection()?t().toggleSelection(n()):t().replaceSelection(n()):l?.shiftKey?t().extendSelection(n()):t().selectionBehavior()==="toggle"||w(l)||"pointerType"in l&&l.pointerType==="touch"?t().toggleSelection(n()):t().replaceSelection(n()));},g=()=>t().isSelected(n()),S=()=>access(s.disabled)||t().isDisabled(n()),h=()=>!S()&&t().canSelectItem(n()),M=null,b=l=>{h()&&(M=l.pointerType,l.pointerType==="mouse"&&l.button===0&&!access(s.shouldSelectOnPressUp)&&a(l));},v=l=>{h()&&l.pointerType==="mouse"&&l.button===0&&access(s.shouldSelectOnPressUp)&&access(s.allowsDifferentPressOrigin)&&a(l);},C=l=>{h()&&(access(s.shouldSelectOnPressUp)&&!access(s.allowsDifferentPressOrigin)||M!=="mouse")&&a(l);},k=l=>{!h()||!["Enter"," "].includes(l.key)||(L(l)?t().toggleSelection(n()):a(l));},T=l=>{S()&&l.preventDefault();},p=l=>{let y=e();o()||S()||!y||l.target===y&&t().setFocusedKey(n());},i=createMemo(()=>{if(!(o()||S()))return n()===t().focusedKey()?0:-1}),u=createMemo(()=>access(s.virtualized)?void 0:n());return createEffect(on([e,n,o,()=>t().focusedKey(),()=>t().isFocused()],([l,y,f,r,E])=>{l&&y===r&&E&&!f&&document.activeElement!==l&&(s.focus?s.focus():focusWithoutScrolling(l));})),{isSelected:g,isDisabled:S,allowsSelection:h,tabIndex:i,dataKey:u,onPointerDown:b,onPointerUp:v,onClick:C,onKeyDown:k,onMouseDown:T,onFocus:p}}var B=class{collection;state;constructor(e,t){this.collection=e,this.state=t;}selectionMode(){return this.state.selectionMode()}disallowEmptySelection(){return this.state.disallowEmptySelection()}selectionBehavior(){return this.state.selectionBehavior()}setSelectionBehavior(e){this.state.setSelectionBehavior(e);}isFocused(){return this.state.isFocused()}setFocused(e){this.state.setFocused(e);}focusedKey(){return this.state.focusedKey()}setFocusedKey(e){(e==null||this.collection().getItem(e))&&this.state.setFocusedKey(e);}selectedKeys(){return this.state.selectedKeys()}isSelected(e){if(this.state.selectionMode()==="none")return !1;let t=this.getKey(e);return t==null?!1:this.state.selectedKeys().has(t)}isEmpty(){return this.state.selectedKeys().size===0}isSelectAll(){if(this.isEmpty())return !1;let e=this.state.selectedKeys();return this.getAllSelectableKeys().every(t=>e.has(t))}firstSelectedKey(){let e;for(let t of this.state.selectedKeys()){let n=this.collection().getItem(t),o=n?.index!=null&&e?.index!=null&&n.index<e.index;(!e||o)&&(e=n);}return e?.key}lastSelectedKey(){let e;for(let t of this.state.selectedKeys()){let n=this.collection().getItem(t),o=n?.index!=null&&e?.index!=null&&n.index>e.index;(!e||o)&&(e=n);}return e?.key}extendSelection(e){if(this.selectionMode()==="none")return;if(this.selectionMode()==="single"){this.replaceSelection(e);return}let t=this.getKey(e);if(t==null)return;let n=this.state.selectedKeys(),o=n.anchorKey||t,a=new m(n,o,t);for(let g of this.getKeyRange(o,n.currentKey||t))a.delete(g);for(let g of this.getKeyRange(t,o))this.canSelectItem(g)&&a.add(g);this.state.setSelectedKeys(a);}getKeyRange(e,t){let n=this.collection().getItem(e),o=this.collection().getItem(t);return n&&o?n.index!=null&&o.index!=null&&n.index<=o.index?this.getKeyRangeInternal(e,t):this.getKeyRangeInternal(t,e):[]}getKeyRangeInternal(e,t){let n=[],o=e;for(;o!=null;){let a=this.collection().getItem(o);if(a&&a.type==="item"&&n.push(o),o===t)return n;o=this.collection().getKeyAfter(o);}return []}getKey(e){let t=this.collection().getItem(e);return t?!t||t.type!=="item"?null:t.key:e}toggleSelection(e){if(this.selectionMode()==="none")return;if(this.selectionMode()==="single"&&!this.isSelected(e)){this.replaceSelection(e);return}let t=this.getKey(e);if(t==null)return;let n=new m(this.state.selectedKeys());n.has(t)?n.delete(t):this.canSelectItem(t)&&(n.add(t),n.anchorKey=t,n.currentKey=t),!(this.disallowEmptySelection()&&n.size===0)&&this.state.setSelectedKeys(n);}replaceSelection(e){if(this.selectionMode()==="none")return;let t=this.getKey(e);if(t==null)return;let n=this.canSelectItem(t)?new m([t],t,t):new m;this.state.setSelectedKeys(n);}setSelectedKeys(e){if(this.selectionMode()==="none")return;let t=new m;for(let n of e){let o=this.getKey(n);if(o!=null&&(t.add(o),this.selectionMode()==="single"))break}this.state.setSelectedKeys(t);}selectAll(){this.selectionMode()==="multiple"&&this.state.setSelectedKeys(new Set(this.getAllSelectableKeys()));}clearSelection(){let e=this.state.selectedKeys();!this.disallowEmptySelection()&&e.size>0&&this.state.setSelectedKeys(new m);}toggleSelectAll(){this.isSelectAll()?this.clearSelection():this.selectAll();}select(e,t){this.selectionMode()!=="none"&&(this.selectionMode()==="single"?this.isSelected(e)&&!this.disallowEmptySelection()?this.toggleSelection(e):this.replaceSelection(e):this.selectionBehavior()==="toggle"||t&&t.pointerType==="touch"?this.toggleSelection(e):this.replaceSelection(e));}isSelectionEqual(e){if(e===this.state.selectedKeys())return !0;let t=this.selectedKeys();if(e.size!==t.size)return !1;for(let n of e)if(!t.has(n))return !1;for(let n of t)if(!e.has(n))return !1;return !0}canSelectItem(e){if(this.state.selectionMode()==="none")return !1;let t=this.collection().getItem(e);return t!=null&&!t.disabled}isDisabled(e){let t=this.collection().getItem(e);return !t||t.disabled}getAllSelectableKeys(){let e=[];return (n=>{for(;n!=null;){if(this.canSelectItem(n)){let o=this.collection().getItem(n);if(!o)continue;o.type==="item"&&e.push(n);}n=this.collection().getKeyAfter(n);}})(this.collection().getFirstKey()),e}};var D=class{keyMap=new Map;iterable;firstKey;lastKey;constructor(e){this.iterable=e;for(let o of e)this.keyMap.set(o.key,o);if(this.keyMap.size===0)return;let t,n=0;for(let[o,a]of this.keyMap)t?(t.nextKey=o,a.prevKey=t.key):(this.firstKey=o,a.prevKey=void 0),a.type==="item"&&(a.index=n++),t=a,t.nextKey=void 0;this.lastKey=t.key;}*[Symbol.iterator](){yield*this.iterable;}getSize(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(e){return this.keyMap.get(e)?.prevKey}getKeyAfter(e){return this.keyMap.get(e)?.nextKey}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(e){return this.keyMap.get(e)}at(e){let t=[...this.getKeys()];return this.getItem(t[e])}};function Ze(s){let e=q(s),n=a({dataSource:()=>access(s.dataSource),getKey:()=>access(s.getKey),getTextValue:()=>access(s.getTextValue),getDisabled:()=>access(s.getDisabled),getSectionChildren:()=>access(s.getSectionChildren),factory:a=>s.filter?new D(s.filter(a)):new D(a)},[()=>s.filter]),o=new B(n,e);return createComputed(()=>{let a=e.focusedKey();a!=null&&!n().getItem(a)&&e.setFocusedKey(void 0);}),{collection:n,selectionManager:()=>o}}

export { m as a, X as b, q as c, $ as d, He as e, Ve as f, B as g, D as h, Ze as i };
