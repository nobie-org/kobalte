import{a as z}from"./O5VGRZP3.jsx";import{g as R}from"./ZSYY5OQU.jsx";import{a as V}from"./A5YUKSV6.jsx";var m=class s extends Set{anchorKey;currentKey;constructor(e,t,n){super(e),e instanceof s?(this.anchorKey=t||e.anchorKey,this.currentKey=n||e.currentKey):(this.anchorKey=t,this.currentKey=n)}};import{access as x,mergeDefaultProps as ee}from"@kobalte/utils";import{createEffect as W,createMemo as j,createSignal as O}from"solid-js";function J(s){let[e,t]=V(s);return[()=>e()??new m,t]}import{isAppleDevice as Q,isMac as Y}from"@kobalte/utils";function L(s){return Q()?s.altKey:s.ctrlKey}function w(s){return Y()?s.metaKey:s.ctrlKey}function H(s){return new m(s)}function X(s,e){if(s.size!==e.size)return!1;for(let t of s)if(!e.has(t))return!1;return!0}function q(s){let e=ee({selectionMode:"none",selectionBehavior:"toggle"},s),[t,n]=O(!1),[o,a]=O(),g=j(()=>{let p=x(e.selectedKeys);return p!=null?H(p):p}),S=j(()=>{let p=x(e.defaultSelectedKeys);return p!=null?H(p):new m}),[h,M]=J({value:g,defaultValue:S,onChange:p=>e.onSelectionChange?.(p)}),[b,v]=O(x(e.selectionBehavior)),C=()=>x(e.selectionMode),k=()=>x(e.disallowEmptySelection)??!1,T=p=>{(x(e.allowDuplicateSelectionEvents)||!X(p,h()))&&M(p)};return W(()=>{let p=h();x(e.selectionBehavior)==="replace"&&b()==="toggle"&&typeof p=="object"&&p.size===0&&v("replace")}),W(()=>{v(x(e.selectionBehavior)??"toggle")}),{selectionMode:C,disallowEmptySelection:k,selectionBehavior:b,setSelectionBehavior:v,isFocused:t,setFocused:n,focusedKey:o,setFocusedKey:a,selectedKeys:h,setSelectedKeys:T}}import{access as N}from"@kobalte/utils";import{createSignal as _}from"solid-js";function $(s){let[e,t]=_(""),[n,o]=_(-1);return{typeSelectHandlers:{onKeyDown:g=>{if(N(s.isDisabled))return;let S=N(s.keyboardDelegate),h=N(s.selectionManager);if(!S.getKeyForSearch)return;let M=te(g.key);if(!M||g.ctrlKey||g.metaKey)return;M===" "&&e().trim().length>0&&(g.preventDefault(),g.stopPropagation());let b=t(C=>C+M),v=S.getKeyForSearch(b,h.focusedKey())??S.getKeyForSearch(b);v==null&&ne(b)&&(b=b[0],v=S.getKeyForSearch(b,h.focusedKey())??S.getKeyForSearch(b)),v!=null&&(h.setFocusedKey(v),s.onTypeSelect?.(v)),clearTimeout(n()),o(window.setTimeout(()=>t(""),500))}}}}function te(s){return s.length===1||!/^[A-Z]/i.test(s)?s:""}function ne(s){return s.split("").every(e=>e===s[0])}import{access as d,callHandler as oe,createEventListener as se,focusWithoutScrolling as U,getFocusableTreeWalker as ie,scrollIntoView as G}from"@kobalte/utils";import{createEffect as le,createMemo as re,mergeProps as ce,on as ae,onMount as de}from"solid-js";function He(s,e,t){let o=ce({selectOnFocus:()=>d(s.selectionManager).selectionBehavior()==="replace"},s),a=()=>t?.()??e(),{direction:g}=R(),S={top:0,left:0};se(()=>d(o.isVirtualized)?void 0:a(),"scroll",()=>{let i=a();i&&(S={top:i.scrollTop,left:i.scrollLeft})});let{typeSelectHandlers:h}=$({isDisabled:()=>d(o.disallowTypeAhead),keyboardDelegate:()=>d(o.keyboardDelegate),selectionManager:()=>d(o.selectionManager)}),M=()=>d(o.orientation)??"vertical",b=i=>{oe(i,h.onKeyDown),i.altKey&&i.key==="Tab"&&i.preventDefault();let u=e();if(!u?.contains(i.target))return;let l=d(o.selectionManager),y=d(o.selectOnFocus),f=c=>{c!=null&&(l.setFocusedKey(c),i.shiftKey&&l.selectionMode()==="multiple"?l.extendSelection(c):y&&!L(i)&&l.replaceSelection(c))},r=d(o.keyboardDelegate),E=d(o.shouldFocusWrap),K=l.focusedKey();switch(i.key){case(M()==="vertical"?"ArrowDown":"ArrowRight"):{if(r.getKeyBelow){i.preventDefault();let c;K!=null?c=r.getKeyBelow(K):c=r.getFirstKey?.(),c==null&&E&&(c=r.getFirstKey?.(K)),f(c)}break}case(M()==="vertical"?"ArrowUp":"ArrowLeft"):{if(r.getKeyAbove){i.preventDefault();let c;K!=null?c=r.getKeyAbove(K):c=r.getLastKey?.(),c==null&&E&&(c=r.getLastKey?.(K)),f(c)}break}case(M()==="vertical"?"ArrowLeft":"ArrowUp"):{if(r.getKeyLeftOf){i.preventDefault();let c=g()==="rtl",A;K!=null?A=r.getKeyLeftOf(K):A=c?r.getFirstKey?.():r.getLastKey?.(),f(A)}break}case(M()==="vertical"?"ArrowRight":"ArrowDown"):{if(r.getKeyRightOf){i.preventDefault();let c=g()==="rtl",A;K!=null?A=r.getKeyRightOf(K):A=c?r.getLastKey?.():r.getFirstKey?.(),f(A)}break}case"Home":if(r.getFirstKey){i.preventDefault();let c=r.getFirstKey(K,w(i));c!=null&&(l.setFocusedKey(c),w(i)&&i.shiftKey&&l.selectionMode()==="multiple"?l.extendSelection(c):y&&l.replaceSelection(c))}break;case"End":if(r.getLastKey){i.preventDefault();let c=r.getLastKey(K,w(i));c!=null&&(l.setFocusedKey(c),w(i)&&i.shiftKey&&l.selectionMode()==="multiple"?l.extendSelection(c):y&&l.replaceSelection(c))}break;case"PageDown":if(r.getKeyPageBelow&&K!=null){i.preventDefault();let c=r.getKeyPageBelow(K);f(c)}break;case"PageUp":if(r.getKeyPageAbove&&K!=null){i.preventDefault();let c=r.getKeyPageAbove(K);f(c)}break;case"a":w(i)&&l.selectionMode()==="multiple"&&d(o.disallowSelectAll)!==!0&&(i.preventDefault(),l.selectAll());break;case"Escape":i.defaultPrevented||(i.preventDefault(),d(o.disallowEmptySelection)||l.clearSelection());break;case"Tab":if(!d(o.allowsTabNavigation)){if(i.shiftKey)u.focus();else{let c=ie(u,{tabbable:!0}),A,I;do I=c.lastChild(),I&&(A=I);while(I);A&&!A.contains(document.activeElement)&&U(A)}break}}},v=i=>{let u=d(o.selectionManager),l=d(o.keyboardDelegate),y=d(o.selectOnFocus);if(u.isFocused()){i.currentTarget.contains(i.target)||u.setFocused(!1);return}if(i.currentTarget.contains(i.target)){if(u.setFocused(!0),u.focusedKey()==null){let f=E=>{E!=null&&(u.setFocusedKey(E),y&&u.replaceSelection(E))},r=i.relatedTarget;r&&i.currentTarget.compareDocumentPosition(r)&Node.DOCUMENT_POSITION_FOLLOWING?f(u.lastSelectedKey()??l.getLastKey?.()):f(u.firstSelectedKey()??l.getFirstKey?.())}else if(!d(o.isVirtualized)){let f=a();if(f){f.scrollTop=S.top,f.scrollLeft=S.left;let r=f.querySelector(`[data-key="${u.focusedKey()}"]`);r&&(U(r),G(f,r))}}}},C=i=>{let u=d(o.selectionManager);i.currentTarget.contains(i.relatedTarget)||u.setFocused(!1)},k=i=>{a()===i.target&&i.preventDefault()},T=()=>{let i=d(o.autoFocus);if(!i)return;let u=d(o.selectionManager),l=d(o.keyboardDelegate),y;i==="first"&&(y=l.getFirstKey?.()),i==="last"&&(y=l.getLastKey?.());let f=u.selectedKeys();f.size&&(y=f.values().next().value),u.setFocused(!0),u.setFocusedKey(y);let r=e();r&&y==null&&!d(o.shouldUseVirtualFocus)&&U(r)};return de(()=>{o.deferAutoFocus?setTimeout(T,0):T()}),le(ae([a,()=>d(o.isVirtualized),()=>d(o.selectionManager).focusedKey()],i=>{let[u,l,y]=i;if(l)y&&o.scrollToKey?.(y);else if(y&&u){let f=u.querySelector(`[data-key="${y}"]`);f&&G(u,f)}})),{tabIndex:re(()=>{if(!d(o.shouldUseVirtualFocus))return d(o.selectionManager).focusedKey()==null?0:-1}),onKeyDown:b,onMouseDown:k,onFocusIn:v,onFocusOut:C}}import{access as F,focusWithoutScrolling as ue}from"@kobalte/utils";import{createEffect as fe,createMemo as Z,on as ye}from"solid-js";function Ve(s,e){let t=()=>F(s.selectionManager),n=()=>F(s.key),o=()=>F(s.shouldUseVirtualFocus),a=l=>{t().selectionMode()!=="none"&&(t().selectionMode()==="single"?t().isSelected(n())&&!t().disallowEmptySelection()?t().toggleSelection(n()):t().replaceSelection(n()):l?.shiftKey?t().extendSelection(n()):t().selectionBehavior()==="toggle"||w(l)||"pointerType"in l&&l.pointerType==="touch"?t().toggleSelection(n()):t().replaceSelection(n()))},g=()=>t().isSelected(n()),S=()=>F(s.disabled)||t().isDisabled(n()),h=()=>!S()&&t().canSelectItem(n()),M=null,b=l=>{h()&&(M=l.pointerType,l.pointerType==="mouse"&&l.button===0&&!F(s.shouldSelectOnPressUp)&&a(l))},v=l=>{h()&&l.pointerType==="mouse"&&l.button===0&&F(s.shouldSelectOnPressUp)&&F(s.allowsDifferentPressOrigin)&&a(l)},C=l=>{h()&&(F(s.shouldSelectOnPressUp)&&!F(s.allowsDifferentPressOrigin)||M!=="mouse")&&a(l)},k=l=>{!h()||!["Enter"," "].includes(l.key)||(L(l)?t().toggleSelection(n()):a(l))},T=l=>{S()&&l.preventDefault()},p=l=>{let y=e();o()||S()||!y||l.target===y&&t().setFocusedKey(n())},i=Z(()=>{if(!(o()||S()))return n()===t().focusedKey()?0:-1}),u=Z(()=>F(s.virtualized)?void 0:n());return fe(ye([e,n,o,()=>t().focusedKey(),()=>t().isFocused()],([l,y,f,r,E])=>{l&&y===r&&E&&!f&&document.activeElement!==l&&(s.focus?s.focus():ue(l))})),{isSelected:g,isDisabled:S,allowsSelection:h,tabIndex:i,dataKey:u,onPointerDown:b,onPointerUp:v,onClick:C,onKeyDown:k,onMouseDown:T,onFocus:p}}var B=class{collection;state;constructor(e,t){this.collection=e,this.state=t}selectionMode(){return this.state.selectionMode()}disallowEmptySelection(){return this.state.disallowEmptySelection()}selectionBehavior(){return this.state.selectionBehavior()}setSelectionBehavior(e){this.state.setSelectionBehavior(e)}isFocused(){return this.state.isFocused()}setFocused(e){this.state.setFocused(e)}focusedKey(){return this.state.focusedKey()}setFocusedKey(e){(e==null||this.collection().getItem(e))&&this.state.setFocusedKey(e)}selectedKeys(){return this.state.selectedKeys()}isSelected(e){if(this.state.selectionMode()==="none")return!1;let t=this.getKey(e);return t==null?!1:this.state.selectedKeys().has(t)}isEmpty(){return this.state.selectedKeys().size===0}isSelectAll(){if(this.isEmpty())return!1;let e=this.state.selectedKeys();return this.getAllSelectableKeys().every(t=>e.has(t))}firstSelectedKey(){let e;for(let t of this.state.selectedKeys()){let n=this.collection().getItem(t),o=n?.index!=null&&e?.index!=null&&n.index<e.index;(!e||o)&&(e=n)}return e?.key}lastSelectedKey(){let e;for(let t of this.state.selectedKeys()){let n=this.collection().getItem(t),o=n?.index!=null&&e?.index!=null&&n.index>e.index;(!e||o)&&(e=n)}return e?.key}extendSelection(e){if(this.selectionMode()==="none")return;if(this.selectionMode()==="single"){this.replaceSelection(e);return}let t=this.getKey(e);if(t==null)return;let n=this.state.selectedKeys(),o=n.anchorKey||t,a=new m(n,o,t);for(let g of this.getKeyRange(o,n.currentKey||t))a.delete(g);for(let g of this.getKeyRange(t,o))this.canSelectItem(g)&&a.add(g);this.state.setSelectedKeys(a)}getKeyRange(e,t){let n=this.collection().getItem(e),o=this.collection().getItem(t);return n&&o?n.index!=null&&o.index!=null&&n.index<=o.index?this.getKeyRangeInternal(e,t):this.getKeyRangeInternal(t,e):[]}getKeyRangeInternal(e,t){let n=[],o=e;for(;o!=null;){let a=this.collection().getItem(o);if(a&&a.type==="item"&&n.push(o),o===t)return n;o=this.collection().getKeyAfter(o)}return[]}getKey(e){let t=this.collection().getItem(e);return t?!t||t.type!=="item"?null:t.key:e}toggleSelection(e){if(this.selectionMode()==="none")return;if(this.selectionMode()==="single"&&!this.isSelected(e)){this.replaceSelection(e);return}let t=this.getKey(e);if(t==null)return;let n=new m(this.state.selectedKeys());n.has(t)?n.delete(t):this.canSelectItem(t)&&(n.add(t),n.anchorKey=t,n.currentKey=t),!(this.disallowEmptySelection()&&n.size===0)&&this.state.setSelectedKeys(n)}replaceSelection(e){if(this.selectionMode()==="none")return;let t=this.getKey(e);if(t==null)return;let n=this.canSelectItem(t)?new m([t],t,t):new m;this.state.setSelectedKeys(n)}setSelectedKeys(e){if(this.selectionMode()==="none")return;let t=new m;for(let n of e){let o=this.getKey(n);if(o!=null&&(t.add(o),this.selectionMode()==="single"))break}this.state.setSelectedKeys(t)}selectAll(){this.selectionMode()==="multiple"&&this.state.setSelectedKeys(new Set(this.getAllSelectableKeys()))}clearSelection(){let e=this.state.selectedKeys();!this.disallowEmptySelection()&&e.size>0&&this.state.setSelectedKeys(new m)}toggleSelectAll(){this.isSelectAll()?this.clearSelection():this.selectAll()}select(e,t){this.selectionMode()!=="none"&&(this.selectionMode()==="single"?this.isSelected(e)&&!this.disallowEmptySelection()?this.toggleSelection(e):this.replaceSelection(e):this.selectionBehavior()==="toggle"||t&&t.pointerType==="touch"?this.toggleSelection(e):this.replaceSelection(e))}isSelectionEqual(e){if(e===this.state.selectedKeys())return!0;let t=this.selectedKeys();if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;for(let n of t)if(!e.has(n))return!1;return!0}canSelectItem(e){if(this.state.selectionMode()==="none")return!1;let t=this.collection().getItem(e);return t!=null&&!t.disabled}isDisabled(e){let t=this.collection().getItem(e);return!t||t.disabled}getAllSelectableKeys(){let e=[];return(n=>{for(;n!=null;){if(this.canSelectItem(n)){let o=this.collection().getItem(n);if(!o)continue;o.type==="item"&&e.push(n)}n=this.collection().getKeyAfter(n)}})(this.collection().getFirstKey()),e}};var D=class{keyMap=new Map;iterable;firstKey;lastKey;constructor(e){this.iterable=e;for(let o of e)this.keyMap.set(o.key,o);if(this.keyMap.size===0)return;let t,n=0;for(let[o,a]of this.keyMap)t?(t.nextKey=o,a.prevKey=t.key):(this.firstKey=o,a.prevKey=void 0),a.type==="item"&&(a.index=n++),t=a,t.nextKey=void 0;this.lastKey=t.key}*[Symbol.iterator](){yield*this.iterable}getSize(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(e){return this.keyMap.get(e)?.prevKey}getKeyAfter(e){return this.keyMap.get(e)?.nextKey}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(e){return this.keyMap.get(e)}at(e){let t=[...this.getKeys()];return this.getItem(t[e])}};import{access as P}from"@kobalte/utils";import{createComputed as ge}from"solid-js";function Ze(s){let e=q(s),n=z({dataSource:()=>P(s.dataSource),getKey:()=>P(s.getKey),getTextValue:()=>P(s.getTextValue),getDisabled:()=>P(s.getDisabled),getSectionChildren:()=>P(s.getSectionChildren),factory:a=>s.filter?new D(s.filter(a)):new D(a)},[()=>s.filter]),o=new B(n,e);return ge(()=>{let a=e.focusedKey();a!=null&&!n().getItem(a)&&e.setFocusedKey(void 0)}),{collection:n,selectionManager:()=>o}}export{m as a,X as b,q as c,$ as d,He as e,Ve as f,B as g,D as h,Ze as i};
