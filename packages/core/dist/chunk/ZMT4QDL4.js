import { a } from './KGX75ZK2.js';
import { getActiveElement, contains, focusWithoutScrolling, access, removeItemFromArray, getDocument, visuallyHiddenStyles, isFocusable, getAllTabbableIn } from '@kobalte/utils';
import { createSignal, createEffect, onCleanup } from 'solid-js';
import { isServer } from 'solid-js/web';

var F="focusScope.autoFocusOnMount",T="focusScope.autoFocusOnUnmount",C={bubbles:!1,cancelable:!0},P={stack:[],active(){return this.stack[0]},add(o){o!==this.active()&&this.active()?.pause(),this.stack=removeItemFromArray(this.stack,o),this.stack.unshift(o);},remove(o){this.stack=removeItemFromArray(this.stack,o),this.active()?.resume();}};function Y(o,i){let[g,A]=createSignal(!1),S={pause(){A(!0);},resume(){A(!1);}},m=null,O=e=>o.onMountAutoFocus?.(e),p=e=>o.onUnmountAutoFocus?.(e),u=()=>getDocument(i()),L=()=>{let e=u().createElement("span");return e.setAttribute("data-focus-trap",""),e.tabIndex=0,Object.assign(e.style,visuallyHiddenStyles),e},U=()=>{let e=i();return e?getAllTabbableIn(e,!0).filter(t=>!t.hasAttribute("data-focus-trap")):[]},_=()=>{let e=U();return e.length>0?e[0]:null},y=()=>{let e=U();return e.length>0?e[e.length-1]:null},I=()=>{let e=i();if(!e)return !1;let t=getActiveElement(e);return !t||contains(e,t)?!1:isFocusable(t)};createEffect(()=>{if(isServer)return;let e=i();if(!e)return;P.add(S);let t=getActiveElement(e);if(!contains(e,t)){let n=new CustomEvent(F,C);e.addEventListener(F,O),e.dispatchEvent(n),n.defaultPrevented||setTimeout(()=>{focusWithoutScrolling(_()),getActiveElement(e)===t&&focusWithoutScrolling(e);},0);}onCleanup(()=>{e.removeEventListener(F,O),setTimeout(()=>{let n=new CustomEvent(T,C);I()&&n.preventDefault(),e.addEventListener(T,p),e.dispatchEvent(n),n.defaultPrevented||focusWithoutScrolling(t??u().body),e.removeEventListener(T,p),P.remove(S);},0);});}),createEffect(()=>{if(isServer)return;let e=i();if(!e||!access(o.trapFocus)||g())return;let t=n=>{let r=n.target;r?.closest(`[${a}]`)||(contains(e,r)?m=r:focusWithoutScrolling(m));},s=n=>{let a$1=n.relatedTarget??getActiveElement(e);a$1?.closest(`[${a}]`)||contains(e,a$1)||focusWithoutScrolling(m);};u().addEventListener("focusin",t),u().addEventListener("focusout",s),onCleanup(()=>{u().removeEventListener("focusin",t),u().removeEventListener("focusout",s);});}),createEffect(()=>{if(isServer)return;let e=i();if(!e||!access(o.trapFocus)||g())return;let t=L();e.insertAdjacentElement("afterbegin",t);let s=L();e.insertAdjacentElement("beforeend",s);function n(a){let l=_(),M=y();a.relatedTarget===l?focusWithoutScrolling(M):focusWithoutScrolling(l);}t.addEventListener("focusin",n),s.addEventListener("focusin",n);let r=new MutationObserver(a=>{for(let l of a)l.previousSibling===s&&(s.remove(),e.insertAdjacentElement("beforeend",s)),l.nextSibling===t&&(t.remove(),e.insertAdjacentElement("afterbegin",t));});r.observe(e,{childList:!0,subtree:!1}),onCleanup(()=>{t.removeEventListener("focusin",n),s.removeEventListener("focusin",n),t.remove(),s.remove(),r.disconnect();});});}

export { Y as a };
